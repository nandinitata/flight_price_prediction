{% extends "base.html" %}

{% block title %}Ensemble Learning - Flight Data Analysis{% endblock %}

{% block content %}
<div class="container py-5">
    <!-- Hero Section -->
    <div class="row mb-5">
        <div class="col-12 text-center">
            <i class="fas fa-layer-group fa-2x mb-3 text-primary"></i>
            <h1 class="display-4 mb-4">Ensemble Learning</h1>
            <p class="lead text-muted">Combining Multiple Models for Improved Predictions</p>
        </div>
    </div>

    <!-- Introduction Section -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h2 class="card-title mb-0">What is Ensemble Learning?</h2>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="ensemble-concept">
                                <p class="lead">
                                    Ensemble learning is a powerful machine learning technique that combines multiple models to create a stronger, more robust predictive system than any individual model could provide.
                                </p>
                                <p>
                                    The key principle behind ensemble methods is that a group of "weak learners" can come together to form a "strong learner." By leveraging the collective intelligence of multiple models, ensemble methods can:
                                </p>
                                <ul>
                                    <li>Reduce overfitting by averaging out biases</li>
                                    <li>Improve prediction accuracy</li>
                                    <li>Provide more stable and reliable results</li>
                                    <li>Handle complex relationships in data more effectively</li>
                                </ul>
                                <p>
                                    Common ensemble methods include:
                                </p>
                                <ul>
                                    <li><strong>Random Forest:</strong> Builds multiple decision trees and merges their predictions</li>
                                    <li><strong>Gradient Boosting:</strong> Builds trees sequentially, with each tree correcting errors of the previous ones</li>
                                    <li><strong>AdaBoost:</strong> Focuses on difficult-to-classify instances by adjusting weights</li>
                                    <li><strong>Voting Classifier:</strong> Combines predictions from multiple different algorithms</li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="text-center">
                                <img src="{{ url_for('static', filename='img/ensemble/ensemble_concept.png') }}" 
                                     class="img-fluid rounded shadow-sm" alt="Ensemble Learning Concept">
                                <p class="text-muted mt-3">
                                    Ensemble learning combines multiple models to create stronger predictions
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Data Transformation Section -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h2 class="card-title mb-0">Data Transformation for Ensemble Learning</h2>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h4>Original Data Structure</h4>
                            <p>The original flight data contains features such as:</p>
                            <ul>
                                <li>Distance category (Short, Medium, Long, VeryLong)</li>
                                <li>Carrier (airline company codes)</li>
                                <li>Market share category (Low, Medium, High)</li>
                                <li>Target: Fare category (VeryLow, Low, Medium, High, VeryHigh)</li>
                            </ul>
                            <div class="table-responsive mt-3">
                                <h5>Original Data Sample</h5>
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>Distance Category</th>
                                            <th>Carrier</th>
                                            <th>Market Share</th>
                                            <th>Fare Category</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for i in range(5) %}
                                        <tr>
                                            <td>{{ model_results['sample_data']['distance_category'][i] }}</td>
                                            <td>{{ model_results['sample_data']['carrier_lg'][i] }}</td>
                                            <td>{{ model_results['sample_data']['market_share_category'][i] }}</td>
                                            <td>{{ model_results['sample_data']['fare_category'][i] }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h4>Transformed Data (One-Hot Encoded)</h4>
                            <p>For ensemble learning, categorical features are converted to binary features:</p>
                            <div class="table-responsive mt-3">
                                <h5>Transformed Data Sample</h5>
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            {% for feature in model_results['feature_names'][:6] %}
                                            <th>{{ feature }}</th>
                                            {% endfor %}
                                            <th>Target</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for i in range(5) %}
                                        <tr>
                                            {% for feature in model_results['feature_names'][:6] %}
                                            <td>{{ model_results['processed_data'][feature][i] }}</td>
                                            {% endfor %}
                                            <td>{{ model_results['processed_data']['target'][i] }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Model Performance Section -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h2 class="card-title mb-0">Model Performance Comparison</h2>
                </div>
                <div class="card-body">
                    <div class="text-center mb-4">
                        <img src="{{ url_for('static', filename='img/ensemble/model_comparison.png') }}" 
                             class="img-fluid rounded shadow-sm" alt="Model Performance Comparison">
                    </div>
                    <div class="row mt-4">
                        {% for model_name, model_data in model_results.items() %}
                        {% if model_name not in ['sample_data', 'processed_data', 'feature_names'] %}
                        <div class="col-md-6 col-lg-3 mb-4">
                            <div class="card h-100">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">{{ model_name }}</h5>
                                </div>
                                <div class="card-body">
                                    <ul class="list-unstyled">
                                        <li><strong>Accuracy:</strong> {{ "%.2f"|format(model_data.accuracy * 100) }}%</li>
                                        <li><strong>Training Time:</strong> {{ "%.3f"|format(model_data.training_time) }}s</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Confusion Matrices Section -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h2 class="card-title mb-0">Confusion Matrices</h2>
                </div>
                <div class="card-body">
                    <div class="text-center">
                        <img src="{{ url_for('static', filename='img/ensemble/confusion_matrices.png') }}" 
                             class="img-fluid rounded shadow-sm" alt="Confusion Matrices">
                    </div>
                    <p class="mt-3">
                        The confusion matrices show how well each model performs in classifying different fare categories. 
                        Each row represents the actual category, while each column represents the predicted category. 
                        The diagonal elements show correct predictions.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Feature Importance Section -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h2 class="card-title mb-0">Feature Importance Analysis</h2>
                </div>
                <div class="card-body">
                    <div class="text-center mb-4">
                        <img src="{{ url_for('static', filename='img/ensemble/feature_importance.png') }}" 
                             class="img-fluid rounded shadow-sm" alt="Feature Importance">
                    </div>
                    <p>
                        The feature importance chart shows which variables have the most influence on predicting fare categories. 
                        This analysis from the Random Forest model helps us understand which factors most significantly impact 
                        flight pricing.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Results Interpretation Section -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h2 class="card-title mb-0">Results Interpretation for Non-Technical Audience</h2>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-lg-6">
                            <h4>What the Results Mean</h4>
                            <ul>
                                <li><strong>Accuracy:</strong> Percentage of correct predictions. Higher is better.</li>
                                <li><strong>Training Time:</strong> How long it takes to train the model. Shorter is generally better for practical applications.</li>
                                <li><strong>Feature Importance:</strong> Which factors most influence flight prices (distance, carrier, market share).</li>
                            </ul>
                            <h4 class="mt-4">Key Findings</h4>
                            <ul>
                                <li>Ensemble methods (especially Random Forest and Gradient Boosting) generally outperform single models</li>
                                <li>Distance category is typically one of the most important features for predicting fare</li>
                                <li>Market share and carrier type also significantly influence pricing</li>
                                <li>The models can predict fare categories with high accuracy, helping travelers understand pricing patterns</li>
                            </ul>
                        </div>
                        <div class="col-lg-6">
                            <h4>Practical Applications</h4>
                            <ul>
                                <li><strong>For Travelers:</strong> Better understanding of when to expect higher or lower fares based on route characteristics</li>
                                <li><strong>For Airlines:</strong> Insights into how their pricing compares to market patterns</li>
                                <li><strong>For Travel Agencies:</strong> Tools to help customers find the best deals</li>
                            </ul>
                            <div class="alert alert-info mt-4">
                                <h5 class="alert-heading"><i class="fas fa-info-circle"></i> Key Takeaway</h5>
                                <p class="mb-0">
                                    Ensemble learning methods consistently provide more accurate predictions than single models, 
                                    demonstrating the power of combining multiple algorithms to solve complex problems like 
                                    flight fare prediction.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Code and Technical Details Section -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h2 class="card-title mb-0">Technical Implementation</h2>
                </div>
                <div class="card-body">
                    <p>
                        Our ensemble learning implementation uses several popular algorithms from scikit-learn:
                    </p>
                    <ul>
                        <li><strong>Random Forest:</strong> Creates multiple decision trees and averages their predictions</li>
                        <li><strong>Gradient Boosting:</strong> Builds trees sequentially to correct previous errors</li>
                        <li><strong>AdaBoost:</strong> Adapts to difficult instances by adjusting weights</li>
                        <li><strong>Voting Classifier:</strong> Combines predictions from multiple different models</li>
                    </ul>
                    <p class="mt-3">
                        The complete implementation includes data preprocessing, model training, evaluation, and visualization.
                    </p>
                    <a href="https://github.com/nandinitata/flight_price_prediction/blob/main/ensemble.py" 
                       class="btn btn-primary" target="_blank">
                        <i class="fab fa-github"></i> View Complete Code on GitHub
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block styles %}
<style>
    .ensemble-concept p, .ensemble-concept li {
        text-align: justify;
    }
    
    .card {
        transition: all 0.3s ease;
    }
    
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }
    
    .table th {
        white-space: nowrap;
    }
    
    .alert-heading {
        font-size: 1.2rem;
        margin-bottom: 0.5rem;
    }
</style>
{% endblock %}